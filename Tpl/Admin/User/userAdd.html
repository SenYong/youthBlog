<include file="Index:head"/>	
<div id="content">
	<div id="content-header">
		<empty name="info['u_id']">
		   <h1>添加用户</h1>
		<else/>
		   <h1>修改用户</h1>
		</empty>
		<div class="btn-group">
			<a href="{:U('/Admin/User/userList')}" class="btn btn-large" title="用户列表"><i class="fa fa-tasks"></i></a>
		</div>
	</div>
	<div id="breadcrumb">
		<a href="index.html" title="回到首页" class="tip-bottom"><i class="fa fa-home"></i> 首页</a>
		<a href="#">用户管理</a>
		<empty name="info['u_id']">
		   <a href="#" class="current">添加用户</a>
		<else/>
		   <a href="#" class="current">修改用户</a>
		</empty>
	</div>
	<div class="container-fluid">
		<div class="row">
			<div class="col-xs-12">
				<div class="widget-box">
					<div class="widget-title">
						<span class="icon">
							<i class="fa fa-user"></i>									
						</span>
						<empty name="info['u_id']">
						   <h5>添加用户</h5>
						<else/>
						   <h5>修改用户</h5>
						   <input type="hidden" value="{$info.u_id}" id="uid">
						</empty>
					</div>
					<div class="widget-content nopadding">
						<form action="#" method="post" class="form-horizontal">
							
							<div class="form-group">
                                <label class="col-sm-3 col-md-3 col-lg-1 control-label">用户名</label>
                                <div class=" col-sm-9 col-md-9 col-lg-10">
                                	<div class="input-group input-group-sm">
										<span class="input-group-addon"><i class="fa fa-user"></i></span>
                                    	<input type="text" value="{$info.u_name}" class="form-control input-sm" placeholder="用户名" name="user" id="user" />
                                    </div>
                                </div>
                            </div>
							
							<div class="form-group">
                                <label class="col-sm-3 col-md-3 col-lg-1 control-label">密码</label>
                                <div class=" col-sm-9 col-md-9 col-lg-10">
                                	<div class="input-group input-group-sm">
										<span class="input-group-addon"><i class="fa fa-laptop"></i></span>
                                    	<input type="password" value="{$info.u_password}" class="form-control input-sm" placeholder="密码" id="password" name="password"/>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="col-sm-3 col-md-3 col-lg-1 control-label">联系邮箱</label>
                                <div class=" col-sm-9 col-md-9 col-lg-10">
                                	<div class="input-group input-group-sm">
										<span class="input-group-addon"><i class="fa fa-envelope"></i></span>
                                    	<input type="email" value="{$info.u_email}" class="form-control input-sm" id="email"/>
                                    </div>
                                </div>
                            </div>
							
							<div class="form-group">
								<label class="col-sm-3 col-md-3 col-lg-1 control-label">描述</label>
								<div class="col-sm-9 col-md-9 col-lg-10">
									<textarea rows="5" class="form-control" id="remark">{$info.u_remark}</textarea>
								</div>
							</div>
							
							<div class="form-group">
                                <label class="col-sm-3 col-md-3 col-lg-1 control-label">添加时间</label>
                                <div class=" col-sm-9 col-md-9 col-lg-10">
                                	<div class="row">
                                		<div class="col-md-6">
                                    		<input type="text" <empty name="info['u_id']">value="{:date("Y-m-d H:i:s",time())}"<else/>value="{:date("Y-m-d H:i:s",$info['u_time'])}"</empty> class="form-control input-sm" id="time" />
                                    	</div>
                                    </div>
                                </div>
                            </div>
                            
							<div class="form-group">
                                <label class="col-sm-3 col-md-3 col-lg-1 control-label">添加人</label>
                                <div class=" col-sm-9 col-md-9 col-lg-10">
                                	<div class="input-group input-group-sm">
										<span class="input-group-addon"><i class="fa fa-user"></i></span>
                                    	<input type="text"  value="{$Think.session.uname}" class="form-control input-sm" id="root"/>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
								<label class="col-sm-3 col-md-3 col-lg-1 control-label">权限组</label>
								<div class="col-sm-9 col-md-9 col-lg-10">
									<select id="class">
										<option value="x">--请选择--</option>
										<option value="1" <eq name="info['u_class']" value="1">selected</eq> >最高管理员</option>
										<option value="2" <eq name="info['u_class']" value="2">selected</eq> >编辑</option>
										<option value="3" <eq name="info['u_class']" value="3">selected</eq> >游客</option>
									</select>
								</div>
							</div>
                            
                            <div class="form-group">
                                <label class="col-sm-3 col-md-3 col-lg-1 control-label">添加IP</label>
                                <div class=" col-sm-9 col-md-9 col-lg-10">
                                	<div class="input-group input-group-sm">
										<span class="input-group-addon"><i class="fa fa-user"></i></span>
                                    	<input type="text" value="{:get_client_ip()}" class="form-control input-sm" id="ip"/>
                                    </div>
                                </div>
                            </div>
                            
							<div class="form-actions">
								<empty name="info['u_id']">
								   <button type="button" class="btn btn-success btn-sm" id="adduser">存入数据库</button> 
								<else/>
                                   <button type="button" class="btn btn-success btn-sm" id="edituser">存入数据库</button> 
								</empty> 
								<button type="button" class="btn btn-danger btn-sm" id="cancel">取消</button>
							</div>
						</form>
					</div>
				</div>						
			</div>
		</div>
	</div>
</div>
<include file="Index:footer"/> 
<script>
$(document).ready(function(){
	$('input[type=checkbox],input[type=radio]').iCheck({
    	checkboxClass: 'icheckbox_flat-blue',
    	radioClass: 'iradio_flat-blue'
	});
	$('select').select2();
    $('.spinner').spinner();
    $('#adduser').click(function(){
    	var user = $('#user').val();
    	var password = $('#password').val();
    	var email = $('#email').val();
    	var remark = $('#remark').val();
    	var time = $('#time').val();
    	var root = $('#root').val();
    	var uclass = $("#class").val();
    	var ip = $("#ip").val();
    	if(!user){
    		err("用户名不能为空");
    		return false;
    	}
    	if(!password){
    		err('密码不能为空');
    		return false;
    	}
    	if(!email){
    		err('邮箱不能为空');
    		return false;
    	}
    	if(!remark){
    		err("描述不能为空");
    		return false;
    	}
    	if(!time){
    		err("时间不能为空");
    		return false;
    	}
    	if(!root){
    		err("添加人不能为空");
    		return false;
    	}
    	if(!uclass){
    		err("请选择权限");
    		return false;
    	}
    	if(!ip){
    		err("ip地址不能为空");
    		return false;
    	}
    	$('#adduser').attr('disabled',true);
    	$.ajax({
    		url: "/Admin/User/userAddH",
    		type: "post",
    		async: true,
    		data: {"u_name":user, "u_password":password, "u_class":uclass, "u_remark":remark, "u_email":email, "u_ip":ip, "u_root":root, "u_time":time},
    		success: function(data){
    			if(data.error == 0){
    				succ("添加用户成功",data.msg,"/Admin/User/userList");
    			}else{
    				err(data.msg);
    				$("#adduser").removeAttr('disabled');
    			}
    		},
    		error: function(data){
    			err("网络错误");
    			$("#adduser").removeAttr('disabled');
    		}
    	})
    })

    $('#cancel').click(function(){
    	window.location.href="/Admin/User/userList";
    })

    //修改
    $('#edituser').click(function(){
    	var uid = $("#uid").val();
    	var user = $('#user').val();
    	var password = $('#password').val();
    	var email = $('#email').val();
    	var remark = $('#remark').val();
    	var time = $('#time').val();
    	var root = $('#root').val();
    	var uclass = $("#class").val();
    	var ip = $("#ip").val();
    	if(!user){
    		err("用户名不能为空");
    		return false;
    	}
    	if(!password){
    		err('密码不能为空');
    		return false;
    	}
    	if(!email){
    		err('邮箱不能为空');
    		return false;
    	}
    	if(!remark){
    		err("描述不能为空");
    		return false;
    	}
    	if(!time){
    		err("时间不能为空");
    		return false;
    	}
    	if(!root){
    		err("添加人不能为空");
    		return false;
    	}
    	if(!uclass){
    		err("请选择权限");
    		return false;
    	}
    	if(!ip){
    		err("ip地址不能为空");
    		return false;
    	}
    	$('#edituser').attr('disabled',true);
    	$.ajax({
    		url: "/Admin/User/userEditH",
    		type: "post",
    		async: true,
    		data: {"u_id":uid, "u_name":user, "u_password":password, "u_class":uclass, "u_remark":remark, "u_email":email, "u_ip":ip, "u_root":root, "u_time":time},
    		success: function(data){
    			if(data.error == 0){
    				succ("修改用户成功",data.msg,"/Admin/User/userList");
    			}else{
    				err(data.msg);
    				$("#edituser").removeAttr('disabled');
    			}
    		},
    		error: function(data){
    			err("网络错误");
    			$("#edituser").removeAttr('disabled');
    		}
    	})
    })
})
</script>
</body>
</html>
